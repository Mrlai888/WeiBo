<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>自定义组件 | 技术文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="manifest" href="/WeiBo/photo.jpg">
    <link rel="apple-touch-icon" href="/WeiBo/photo.jpg">
    <meta name="description" content="我的个人网站">
    
    <link rel="preload" href="/WeiBo/assets/css/0.styles.408a9db9.css" as="style"><link rel="preload" href="/WeiBo/assets/js/app.de0b0b11.js" as="script"><link rel="preload" href="/WeiBo/assets/js/2.36bf89d1.js" as="script"><link rel="preload" href="/WeiBo/assets/js/25.72d6a3ee.js" as="script"><link rel="prefetch" href="/WeiBo/assets/js/10.e33a5240.js"><link rel="prefetch" href="/WeiBo/assets/js/11.0acf05f2.js"><link rel="prefetch" href="/WeiBo/assets/js/12.3f073600.js"><link rel="prefetch" href="/WeiBo/assets/js/13.def5cb41.js"><link rel="prefetch" href="/WeiBo/assets/js/14.67d442a3.js"><link rel="prefetch" href="/WeiBo/assets/js/15.6aa6a43b.js"><link rel="prefetch" href="/WeiBo/assets/js/16.0dbfc0a7.js"><link rel="prefetch" href="/WeiBo/assets/js/17.0bbf9d85.js"><link rel="prefetch" href="/WeiBo/assets/js/18.6c0115c7.js"><link rel="prefetch" href="/WeiBo/assets/js/19.8af7ae2f.js"><link rel="prefetch" href="/WeiBo/assets/js/20.6b8bc693.js"><link rel="prefetch" href="/WeiBo/assets/js/21.258cb1b2.js"><link rel="prefetch" href="/WeiBo/assets/js/22.51e83a58.js"><link rel="prefetch" href="/WeiBo/assets/js/23.098efe96.js"><link rel="prefetch" href="/WeiBo/assets/js/24.798d0f95.js"><link rel="prefetch" href="/WeiBo/assets/js/26.8d0786bf.js"><link rel="prefetch" href="/WeiBo/assets/js/27.1dacffe6.js"><link rel="prefetch" href="/WeiBo/assets/js/28.a1f2bc7b.js"><link rel="prefetch" href="/WeiBo/assets/js/29.c6239048.js"><link rel="prefetch" href="/WeiBo/assets/js/3.eb8d5ed9.js"><link rel="prefetch" href="/WeiBo/assets/js/30.8546514e.js"><link rel="prefetch" href="/WeiBo/assets/js/31.d392c00d.js"><link rel="prefetch" href="/WeiBo/assets/js/32.23b9c222.js"><link rel="prefetch" href="/WeiBo/assets/js/33.19b86591.js"><link rel="prefetch" href="/WeiBo/assets/js/4.7f0c1c53.js"><link rel="prefetch" href="/WeiBo/assets/js/5.607e5447.js"><link rel="prefetch" href="/WeiBo/assets/js/6.6bb92c25.js"><link rel="prefetch" href="/WeiBo/assets/js/7.4c3ce0c9.js"><link rel="prefetch" href="/WeiBo/assets/js/8.815f15a3.js"><link rel="prefetch" href="/WeiBo/assets/js/9.e0a3c4b2.js">
    <link rel="stylesheet" href="/WeiBo/assets/css/0.styles.408a9db9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/WeiBo/" class="home-link router-link-active"><!----> <span class="site-name">技术文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/WeiBo/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/WeiBo/me/" class="nav-link">
  个人中心
</a></div><div class="nav-item"><a href="/WeiBo/html/" class="nav-link">
  html/css
</a></div><div class="nav-item"><a href="/WeiBo/js/" class="nav-link">
  js
</a></div><div class="nav-item"><a href="/WeiBo/vue/" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/WeiBo/react/" class="nav-link router-link-active">
  react
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="more" class="dropdown-title"><span class="title">more</span> <span class="arrow down"></span></button> <button type="button" aria-label="more" class="mobile-dropdown-title"><span class="title">more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          拓展
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/WeiBo/more/Hybrid.html" class="nav-link">
  混合开发
</a></li><li class="dropdown-subitem"><a href="/WeiBo/more/login.html" class="nav-link">
  登录注册服务端
</a></li><li class="dropdown-subitem"><a href="/WeiBo/more/mysql.html" class="nav-link">
  Mysql
</a></li></ul></li><li class="dropdown-item"><h4>
          更多
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/WeiBo/more/yunServer.html" class="nav-link">
  云开发
</a></li><li class="dropdown-subitem"><a href="/WeiBo/more/ts.html" class="nav-link">
  typeScript
</a></li><li class="dropdown-subitem"><a href="/WeiBo/more/webpack.html" class="nav-link">
  webpack
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/Mrlai888" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/WeiBo/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/WeiBo/me/" class="nav-link">
  个人中心
</a></div><div class="nav-item"><a href="/WeiBo/html/" class="nav-link">
  html/css
</a></div><div class="nav-item"><a href="/WeiBo/js/" class="nav-link">
  js
</a></div><div class="nav-item"><a href="/WeiBo/vue/" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/WeiBo/react/" class="nav-link router-link-active">
  react
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="more" class="dropdown-title"><span class="title">more</span> <span class="arrow down"></span></button> <button type="button" aria-label="more" class="mobile-dropdown-title"><span class="title">more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          拓展
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/WeiBo/more/Hybrid.html" class="nav-link">
  混合开发
</a></li><li class="dropdown-subitem"><a href="/WeiBo/more/login.html" class="nav-link">
  登录注册服务端
</a></li><li class="dropdown-subitem"><a href="/WeiBo/more/mysql.html" class="nav-link">
  Mysql
</a></li></ul></li><li class="dropdown-item"><h4>
          更多
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/WeiBo/more/yunServer.html" class="nav-link">
  云开发
</a></li><li class="dropdown-subitem"><a href="/WeiBo/more/ts.html" class="nav-link">
  typeScript
</a></li><li class="dropdown-subitem"><a href="/WeiBo/more/webpack.html" class="nav-link">
  webpack
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/Mrlai888" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/WeiBo/react/" aria-current="page" class="sidebar-link">react知识点整理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/WeiBo/react/home.html" class="sidebar-link">react基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#生命周期钩子函数" class="sidebar-link">生命周期钩子函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#挂载阶段" class="sidebar-link">挂载阶段</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#更新阶段" class="sidebar-link">更新阶段</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#销毁阶段" class="sidebar-link">销毁阶段</a></li></ul></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#this指向总结" class="sidebar-link">this指向总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#react中定义的事件this指向默认是undefined-因为指向的事件是自定义的属性-只能其他方法通过改变this指向" class="sidebar-link" style="padding-left:3rem;">react中定义的事件this指向默认是undefined 因为指向的事件是自定义的属性，只能其他方法通过改变this指向</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#当事件-不传递参数时" class="sidebar-link">当事件 不传递参数时</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#传递参数时" class="sidebar-link">传递参数时</a></li></ul></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#react-表单" class="sidebar-link">react-表单</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#受控组件" class="sidebar-link">受控组件</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#非受控组件" class="sidebar-link">非受控组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#react-props" class="sidebar-link">react-props</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#props-的默认值设置" class="sidebar-link">props 的默认值设置</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#prop的校验" class="sidebar-link">prop的校验</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#自-react-v15-5-以后-react-propstypes-已经移入prop-types包中-安装-yarn-add-prop-types" class="sidebar-link" style="padding-left:3rem;">自 React v15.5 以后，react-propsTypes 已经移入prop-types包中  安装&quot;yarn add prop-types&quot;</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#组件通信context的两种使用方式" class="sidebar-link">组件通信context的两种使用方式</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#context使用" class="sidebar-link" style="padding-left:3rem;">context使用</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#第一种使用方式" class="sidebar-link" style="padding-left:3rem;">第一种使用方式</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#消费者-consumer-的第二种使用种方法" class="sidebar-link" style="padding-left:3rem;">消费者（Consumer）的第二种使用种方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#react中hook使用" class="sidebar-link">react中Hook使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#usestate" class="sidebar-link">useState</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#useeffect" class="sidebar-link">useEffect</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#usecontext" class="sidebar-link">useContext</a></li></ul></li><li class="sidebar-sub-header"><a href="/WeiBo/react/home.html#类组件-redux" class="sidebar-link">类组件 redux</a></li></ul></li><li><a href="/WeiBo/react/period.html" class="sidebar-link">生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/period.html#挂载阶段" class="sidebar-link">挂载阶段</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/period.html#更新阶段" class="sidebar-link">更新阶段</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/period.html#销毁阶段" class="sidebar-link">销毁阶段</a></li></ul></li><li><a href="/WeiBo/react/router.html" class="sidebar-link">React路由</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/router.html#react路由" class="sidebar-link">react路由</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/router.html#路由意义" class="sidebar-link">路由意义</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/router.html#react路由简介" class="sidebar-link">react路由简介</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/router.html#react路由使用" class="sidebar-link">react路由使用</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/router.html#路由页面组件-跟路由相关的组件就称为路由页面组件。" class="sidebar-link">路由页面组件（跟路由相关的组件就称为路由页面组件。）</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/router.html#路由页面组件会自动接收到3个prop" class="sidebar-link" style="padding-left:3rem;">路由页面组件会自动接收到3个prop</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/router.html#路由重定向-redirect-组件" class="sidebar-link">路由重定向 Redirect 组件</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/router.html#路由拦截" class="sidebar-link">路由拦截</a></li></ul></li></ul></li><li><a href="/WeiBo/react/hook.html" class="sidebar-link">自定义HOOK</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/hook.html#自定义hook" class="sidebar-link">自定义HOOK</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/hook.html#初始化不渲染-useeffect" class="sidebar-link">初始化不渲染 useEffect</a></li></ul></li></ul></li><li><a href="/WeiBo/react/components.html" aria-current="page" class="active sidebar-link">自定义组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/components.html#自定义组件" class="sidebar-link">自定义组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WeiBo/react/components.html#日历组件" class="sidebar-link">日历组件</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/components.html#仪表盘" class="sidebar-link">仪表盘</a></li><li class="sidebar-sub-header"><a href="/WeiBo/react/components.html#上传文件" class="sidebar-link">上传文件</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="自定义组件"><a href="#自定义组件" class="header-anchor">#</a> 自定义组件</h2> <h3 id="日历组件"><a href="#日历组件" class="header-anchor">#</a> 日历组件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> touch <span class="token keyword">from</span> <span class="token string">'components/crossBorder-touch'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> _ <span class="token keyword">from</span> <span class="token string">&quot;lodash&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Swiper <span class="token keyword">from</span> <span class="token string">'swiper'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'swiper/swiper.scss'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.scss'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">DateItem</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     *
     * @param  dayNum 日数, 如果和 new Date().getDate() 相等则是今天
     * @param  isNeedTag=false 是否需要添加标签
     * @param  isSelected=false 小于于今日和这个月的日期不能选择
     */</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dayNum<span class="token punctuation">,</span> isNeedTag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isSelected <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            dayNum<span class="token punctuation">,</span>
            isNeedTag<span class="token punctuation">,</span>
            isSelected<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">l</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token keyword">const</span> weeks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;日&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;一&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;二&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;四&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;五&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;六&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">CroBorDataPicker</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>swiperInstance <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            date<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            year<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            month<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            currentCard<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            dayList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            pickerList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            nowadays<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            isShowDateSelect<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            croBorDate<span class="token operator">:</span> props<span class="token punctuation">.</span>croBorDate<span class="token punctuation">,</span>
            prevMonth<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            nextMonth<span class="token operator">:</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



    <span class="token function-variable function">initState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> y<span class="token punctuation">,</span> m<span class="token punctuation">,</span> d <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> year <span class="token operator">=</span> y <span class="token operator">||</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 本年</span>
        <span class="token keyword">const</span> month <span class="token operator">=</span> m <span class="token operator">||</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 本月</span>

        <span class="token keyword">const</span> nextMonth <span class="token operator">=</span> <span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">12</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下个月</span>
        <span class="token keyword">const</span> prevMonth <span class="token operator">=</span> <span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">12</span> <span class="token operator">:</span> <span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 上个月</span>
        <span class="token keyword">const</span> nowadays <span class="token operator">=</span> d <span class="token operator">||</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当前时间</span>
        <span class="token keyword">let</span> nowTime <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>year <span class="token operator">==</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> month <span class="token operator">==</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            nowTime <span class="token operator">=</span> nowadays
        <span class="token punctuation">}</span>
        <span class="token comment">// console.log(year, month,'year, month')</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment">// 计算上个月、下个月</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">12</span> <span class="token operator">?</span> year <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> nextMonth<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> year <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> prevMonth<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            date<span class="token punctuation">,</span>
            year<span class="token punctuation">,</span>
            month<span class="token punctuation">,</span>
            nowadays<span class="token operator">:</span> nowTime<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 获取月份数据</span>
    <span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token parameter">year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log('我被执行le',index)</span>
        <span class="token keyword">let</span> daysList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>dayList<span class="token punctuation">;</span>
        <span class="token keyword">let</span> pickerListRes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pickerList


        <span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 时间列表</span>
        <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// 当前月天数</span>
        <span class="token keyword">let</span> date2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 最后一天</span>
        <span class="token keyword">let</span> days <span class="token operator">=</span> date2<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// 当前月月第一天是星期几</span>
        <span class="token keyword">let</span> firstDay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>year<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>month<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> day <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>firstDay<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> isSelected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> thisMonth <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 本月</span>
        <span class="token keyword">const</span> thisYear <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 本年</span>
        <span class="token keyword">const</span> date2GtDate <span class="token operator">=</span> firstDay <span class="token operator">&lt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 是否小于当前时间</span>
        <span class="token keyword">const</span> isCurrentTime <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>year <span class="token operator">-</span> month<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">==</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>thisYear <span class="token operator">-</span> thisMonth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// 选择的日期的月份是否是本月</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> days <span class="token operator">+</span> day<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> dayNum <span class="token operator">=</span> i <span class="token operator">-</span> day <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>date2GtDate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>isCurrentTime <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>day <span class="token operator">+</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    isSelected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    isSelected <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                isSelected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> day<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 补充日期前面空缺</span>
                list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DateItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dayNum<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> isSelected<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DateItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dayNum<span class="token punctuation">,</span> isSelected <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> dayListItem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHlist</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> isSelected<span class="token punctuation">)</span>
        daysList<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> days<span class="token punctuation">,</span> day <span class="token punctuation">}</span>
        pickerListRes<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> dayListItem
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>pickerListRes<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dayList<span class="token operator">:</span> daysList<span class="token punctuation">,</span>pickerList<span class="token operator">:</span> result <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 把一维日期切成二维日期</span>
    <span class="token function-variable function">getHlist</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> isSelected</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> hlist <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">chunk</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转化为二维数组</span>
        <span class="token keyword">let</span> len <span class="token operator">=</span> hlist<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">let</span> to <span class="token operator">=</span> <span class="token number">7</span> <span class="token operator">-</span> hlist<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

        <span class="token comment">// 循环尾部补空格</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> to<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hlist<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DateItem</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dayNum<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> isSelected<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> hlist<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

 <span class="token comment">// 点击左右按钮滑动</span>

    <span class="token function">handleMonth</span><span class="token punctuation">(</span><span class="token parameter">flag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>dayList<span class="token punctuation">,</span> <span class="token string">'dayList'</span><span class="token punctuation">)</span>
        <span class="token comment">// return</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> currentCard<span class="token punctuation">,</span> month<span class="token punctuation">,</span> year <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
        <span class="token comment">// 下标</span>
        <span class="token keyword">let</span> currentMonth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">let</span> currentYear <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> currentCard<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">===</span> <span class="token string">'left'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>currentMonth <span class="token operator">===</span> month <span class="token operator">&amp;&amp;</span> currentYear <span class="token operator">===</span> year<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">l</span><span class="token punctuation">(</span><span class="token string">'无法选择下一个月'</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
            index <span class="token operator">=</span> index <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> index <span class="token operator">-</span> <span class="token number">1</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleslideToLoop</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span><span class="token number">900</span><span class="token punctuation">,</span>currentCard<span class="token punctuation">,</span><span class="token string">'slidePrev'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            index <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> index <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleslideToLoop</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span><span class="token number">900</span><span class="token punctuation">,</span>currentCard<span class="token punctuation">,</span><span class="token string">'slideNext'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        
    <span class="token punctuation">}</span>

    <span class="token function-variable function">handleslideToLoop</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span>speed<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span>currentCard<span class="token punctuation">,</span>methods</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span><span class="token string">'indexx'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>swiperInstance <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>swiperInstance<span class="token punctuation">[</span>methods<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> thisMonthInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>dayList<span class="token punctuation">[</span>currentCard<span class="token punctuation">]</span>
            <span class="token keyword">let</span> <span class="token punctuation">{</span> year<span class="token punctuation">,</span> month <span class="token punctuation">}</span> <span class="token operator">=</span> thisMonthInfo<span class="token punctuation">;</span>
            <span class="token keyword">const</span> nextMonth <span class="token operator">=</span> <span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">12</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下个月</span>
            <span class="token keyword">const</span> prevMonth <span class="token operator">=</span> <span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">12</span> <span class="token operator">:</span> <span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 上个月</span>
            <span class="token comment">// index 0当前月  1 下个月   2上个月</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 当前月，需要计算上一月、下一月</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">12</span> <span class="token operator">?</span> year <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> nextMonth<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> year <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> prevMonth<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 下个月，需要计算当前月、上个月</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">12</span> <span class="token operator">?</span> year <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> nextMonth<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> year <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> prevMonth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 上个月，需要计算当前月、下个月</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">12</span> <span class="token operator">?</span> year <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> nextMonth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> year <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> prevMonth<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                currentCard<span class="token operator">:</span> index<span class="token punctuation">,</span>
                year<span class="token punctuation">,</span>
                month
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 点击每个日期</span>
    <span class="token function-variable function">handleDateItemClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dateItem<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> date<span class="token punctuation">,</span> nowadays <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> isSelected<span class="token punctuation">,</span> isNeedTag<span class="token punctuation">,</span> dayNum <span class="token punctuation">}</span> <span class="token operator">=</span> dateItem<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dayNum <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> selectDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>year<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>month<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dayNum<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nowadays <span class="token operator">===</span> dayNum<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 今天不可被选择</span>
            <span class="token function">l</span><span class="token punctuation">(</span><span class="token string">&quot;不可选择&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>selectDate <span class="token operator">&gt;</span> date<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">l</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>selectDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>isSelected<span class="token punctuation">)</span>
            <span class="token comment">// 小于今天的日期不能被选择</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// const hlist = state.hlist.slice();</span>
            <span class="token keyword">const</span> currentData <span class="token operator">=</span> selectDate<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// hlist[i][j].isNeedTag = true;</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token comment">// hlist,</span>
                nowadays<span class="token operator">:</span> currentData
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> dayNum<span class="token punctuation">,</span><span class="token string">'点击每个日期'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onSelectCroBorDate <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onSelectCroBorDate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> dayNum <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 切换轮播图</span>
    <span class="token function-variable function">getCurrentCardNum</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> swiper</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> thisMonthInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>dayList<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thisMonthInfo<span class="token punctuation">,</span> <span class="token string">'thisMonthInfo'</span><span class="token punctuation">)</span>
        <span class="token comment">// return</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span> year<span class="token punctuation">,</span> month <span class="token punctuation">}</span> <span class="token operator">=</span> thisMonthInfo<span class="token punctuation">;</span>
        <span class="token keyword">const</span> nextMonth <span class="token operator">=</span> <span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">12</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下个月</span>
        <span class="token keyword">const</span> prevMonth <span class="token operator">=</span> <span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">12</span> <span class="token operator">:</span> <span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 上个月</span>
        <span class="token comment">// index 0当前月  1 下个月   2上个月</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 当前月，需要计算上一月、下一月</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">12</span> <span class="token operator">?</span> year <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> nextMonth<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> year <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> prevMonth<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 下个月，需要计算当前月、上个月</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">12</span> <span class="token operator">?</span> year <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> nextMonth<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> year <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> prevMonth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 上个月，需要计算当前月、下个月</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">12</span> <span class="token operator">?</span> year <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> nextMonth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMonthDate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">?</span> year <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> year<span class="token punctuation">,</span> prevMonth<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            currentCard<span class="token operator">:</span> index<span class="token punctuation">,</span>
            year<span class="token punctuation">,</span>
            month
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// swiper.update();</span>
    <span class="token punctuation">}</span>

    <span class="token function">selectDateCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> currentYear <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>year
        <span class="token keyword">let</span> year <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> yearArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> year<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            yearArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> yearList <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">chunk</span><span class="token punctuation">(</span>yearArr<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转化为二维数组</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div
                className<span class="token operator">=</span><span class="token string">'data-picker-selectyear'</span>
            <span class="token operator">&gt;</span>
                <span class="token punctuation">{</span>yearList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token punctuation">(</span>
                        <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
                            <span class="token punctuation">{</span><span class="token operator">&lt;</span>ul className<span class="token operator">=</span><span class="token string">'data-picker-selectyear-row'</span> key<span class="token operator">=</span><span class="token punctuation">{</span>index <span class="token operator">+</span> <span class="token string">'item'</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
                                item<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                    <span class="token keyword">return</span> <span class="token punctuation">(</span>
                                        <span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
                                            <span class="token operator">&lt;</span>li className<span class="token operator">=</span><span class="token punctuation">{</span>el <span class="token operator">==</span> currentYear <span class="token operator">?</span> <span class="token string">'data-picker-selectyear-selectitem'</span> <span class="token operator">:</span> <span class="token string">'data-picker-selectyear-item'</span><span class="token punctuation">}</span>
                                                key<span class="token operator">=</span><span class="token punctuation">{</span>i <span class="token operator">+</span> <span class="token string">'el'</span><span class="token punctuation">}</span>
                                                onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleSelectYear</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                                                <span class="token punctuation">{</span>el<span class="token punctuation">}</span>
                                            <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
                                        <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                    <span class="token punctuation">)</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                            <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span><span class="token punctuation">}</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">handleSelectYear</span><span class="token punctuation">(</span><span class="token parameter">year</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>month<span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> month <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>month <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> y<span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span><span class="token punctuation">,</span>m<span class="token operator">:</span>month <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isShowDateSelect<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">showDate</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(list,'list')</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> nowadays <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>table<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>tbody<span class="token operator">&gt;</span>
                        <span class="token punctuation">{</span>
                            list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> <span class="token punctuation">(</span>
                                    <span class="token operator">&lt;</span>tr key<span class="token operator">=</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token operator">&gt;</span>
                                        <span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dateItem<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                            <span class="token comment">// console.log(item,'itemmmm')</span>
                                            <span class="token keyword">const</span> dayNum <span class="token operator">=</span> dateItem<span class="token punctuation">.</span>dayNum<span class="token punctuation">;</span>
                                            <span class="token comment">// const isNeedTag = dateItem.isNeedTag;</span>
                                            <span class="token keyword">const</span> isSelected <span class="token operator">=</span> dateItem<span class="token punctuation">.</span>isSelected<span class="token punctuation">;</span>
                                            <span class="token comment">// const isToday = dayNum === new Date().getDate()</span>
                                            <span class="token keyword">let</span> currentDate <span class="token operator">=</span> <span class="token keyword">null</span>
                                            <span class="token keyword">if</span> <span class="token punctuation">(</span>nowadays <span class="token operator">===</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                                currentDate <span class="token operator">=</span> nowadays <span class="token operator">+</span> <span class="token number">1</span>
                                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                                currentDate <span class="token operator">=</span> nowadays
                                            <span class="token punctuation">}</span>
                                            <span class="token keyword">return</span> <span class="token punctuation">(</span>
                                                <span class="token operator">&lt;</span>td
                                                    key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dayNum<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span>
                                                    className<span class="token operator">=</span><span class="token punctuation">{</span>isSelected <span class="token operator">?</span> <span class="token string">'data-picker-dateitem disabel'</span> <span class="token operator">:</span> <span class="token string">'data-picker-dateitem'</span><span class="token punctuation">}</span>
                                                    onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleDateItemClick</span><span class="token punctuation">(</span>dateItem<span class="token punctuation">,</span> i<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">}</span>
                                                <span class="token operator">&gt;</span>
                                                    <span class="token punctuation">{</span><span class="token comment">/* &lt;div className={dayNum === nowadays ? 'data-picker-nowdaytime' : isToday ? 'data-picker-daytime today' : 'data-picker-daytime'}&gt;{dayNum ? dayNum : ''}&lt;/div&gt; */</span><span class="token punctuation">}</span>
                                                    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>dayNum <span class="token operator">===</span> currentDate <span class="token operator">?</span> <span class="token string">'data-picker-nowdaytime'</span> <span class="token operator">:</span> <span class="token string">'data-picker-daytime'</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>dayNum <span class="token operator">?</span> dayNum <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                                                <span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
                                            <span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">}</span>
                                    <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
                                <span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>tbody<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>


    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> dayList<span class="token punctuation">,</span> pickerList<span class="token punctuation">,</span> isShowDateSelect <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'data-picker'</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'data-picker-header'</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'data-picker-monthselect'</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>month<span class="token punctuation">}</span>  <span class="token punctuation">{</span>year<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>i onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isShowDateSelect<span class="token operator">:</span> <span class="token operator">!</span>isShowDateSelect <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                    <span class="token punctuation">{</span><span class="token operator">!</span>isShowDateSelect <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'data-picker-monthchange'</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>i className<span class="token operator">=</span><span class="token string">'data-picker-monthchange-left '</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleMonth</span><span class="token punctuation">(</span><span class="token string">'left'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>i className<span class="token operator">=</span><span class="token string">'data-picker-monthchange-right'</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleMonth</span><span class="token punctuation">(</span><span class="token string">'right'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'data-picker-content'</span>
                <span class="token comment">// onTouchEnd={touch.onTouchEnd}</span>
                <span class="token comment">// onTouchStart={touch.onTouchStart}</span>
                <span class="token comment">// onTouchMove={touch.onTouchMove}</span>
                <span class="token operator">&gt;</span>
                    <span class="token punctuation">{</span>isShowDateSelect <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">selectDateCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                    <span class="token punctuation">{</span>weeks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
                        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'data-picker-weak'</span> key<span class="token operator">=</span><span class="token punctuation">{</span>el<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>el<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'data-picker-label'</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;swiper-container&quot;</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;swiper-wrapper&quot;</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;swiper-slide&quot;</span> key<span class="token operator">=</span><span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                                    <span class="token punctuation">{</span>
                                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showDate</span><span class="token punctuation">(</span>pickerList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">}</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;swiper-slide&quot;</span> key<span class="token operator">=</span><span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                                    <span class="token punctuation">{</span>
                                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showDate</span><span class="token punctuation">(</span>pickerList<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">}</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;swiper-slide&quot;</span> key<span class="token operator">=</span><span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                                    <span class="token punctuation">{</span>
                                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showDate</span><span class="token punctuation">(</span>pickerList<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">}</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>croBorDate<span class="token punctuation">,</span> <span class="token string">'fffff'</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> year <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>croBorDate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> month <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>croBorDate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">let</span> day <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>croBorDate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> y<span class="token operator">:</span> year<span class="token punctuation">,</span> m<span class="token operator">:</span> month<span class="token punctuation">,</span> d<span class="token operator">:</span> day <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>swiperInstance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>swiperInstance<span class="token punctuation">.</span><span class="token function">loopDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>swiperInstance<span class="token punctuation">.</span><span class="token function">loopCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//替换this,防止与Swiper中的this冲突</span>
        <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> SwiperInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Swiper</span><span class="token punctuation">(</span><span class="token string">'.swiper-container'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token comment">//各卡片之间的间距</span>
                spaceBetween<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                <span class="token comment">//    slidesOffsetBefore:-6,</span>
                <span class="token comment">//    slidesOffsetAfter:8,</span>
                <span class="token comment">// //卡片轮播方向</span>
                direction<span class="token operator">:</span> <span class="token string">'horizontal'</span><span class="token punctuation">,</span>
                loop<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 循环播放</span>

                observer<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//开启动态检查器  数据变化重新渲染swiper  必须加否则出现数据更新但是视图未更新情况</span>
                observeParents<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 数据变化重新渲染swiper  必须加否则出现数据更新但是视图未更新情况</span>

                <span class="token comment">// // 自动播放时间</span>
                autoplay<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token comment">// // 播放的速度</span>
                speed<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
                on<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token function-variable function">slideChangeTransitionEnd</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">swiper</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// alert(this.activeIndex);//切换结束时，告诉我现在是第几个slide</span>
                        self<span class="token punctuation">.</span><span class="token function">getCurrentCardNum</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>realIndex<span class="token punctuation">,</span> swiper<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">slideChange</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'改变了，activeIndex为'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>realIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            self<span class="token punctuation">.</span>swiperInstance <span class="token operator">=</span> SwiperInstance

        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
        <span class="token comment">//swiper的配置</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CroBorDataPicker<span class="token punctuation">;</span>

</code></pre></div><h3 id="仪表盘"><a href="#仪表盘" class="header-anchor">#</a> 仪表盘</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 半圆端部带胶囊</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> <span class="token constant">FC</span><span class="token punctuation">,</span> useCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> thousandBitSeparator<span class="token punctuation">,</span> keep2DecimalFull <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'src/utils/NumUtils'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./progress.scss'</span><span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">ProgressProps</span> <span class="token punctuation">{</span>
    actualPayamt<span class="token operator">:</span> any<span class="token punctuation">,</span>
    totalPayment<span class="token operator">:</span> any
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Progress<span class="token operator">:</span> <span class="token constant">FC</span><span class="token operator">&lt;</span>ProgressProps<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> actualPayamt<span class="token punctuation">,</span> totalPayment <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token keyword">interface</span> <span class="token class-name">Draw</span> <span class="token punctuation">{</span>
        min<span class="token operator">:</span> number
        max<span class="token operator">:</span> number
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> draw <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> min<span class="token punctuation">,</span> max <span class="token punctuation">}</span><span class="token operator">:</span> Draw<span class="token punctuation">,</span> sRadius<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>min <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> min <span class="token operator">&gt;</span> max<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sRadius <span class="token operator">&lt;</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">||</span> sRadius <span class="token operator">&gt;=</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> canvas<span class="token operator">:</span> any <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#canvas'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">,</span>
            cxt <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cWidth <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
            radiux <span class="token operator">=</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token comment">//半径</span>
            bottom <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
            outBorder <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span><span class="token comment">//外层弧形宽度</span>
            insideBodrder <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token comment">//内层弧形宽度</span>
            cHeight <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
            baseColor <span class="token operator">=</span> <span class="token string">'#F3F3F4'</span><span class="token punctuation">,</span><span class="token comment">//灰色背景</span>
            coverColor <span class="token operator">=</span> <span class="token string">'#0bffd5'</span><span class="token punctuation">,</span><span class="token comment">//填充效果</span>
            cileColor <span class="token operator">=</span> <span class="token string">&quot;#FFFFFF&quot;</span><span class="token punctuation">,</span><span class="token comment">//圆球效果</span>
            <span class="token constant">PI</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">,</span>
            sR <span class="token operator">=</span> sRadius <span class="token operator">||</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token constant">PI</span> <span class="token comment">// 默认圆弧的起始点弧度为π/2</span>
        <span class="token keyword">const</span> finalRadian <span class="token operator">=</span> sR <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">PI</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token constant">PI</span> <span class="token operator">-</span> sR<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> min <span class="token operator">/</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 红圈的终点弧度</span>
        <span class="token keyword">const</span> step <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">PI</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token constant">PI</span> <span class="token operator">-</span> sR<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">// 一个1%对应的弧度大小</span>
        <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">;</span> <span class="token comment">// 进度 最大值100</span>
        <span class="token comment">//适配各种分辨率屏幕</span>
        <span class="token keyword">const</span> ratio <span class="token operator">=</span> <span class="token function">getPixelRatio</span><span class="token punctuation">(</span>cxt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
        cxt<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>ratio<span class="token punctuation">,</span> ratio<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> <span class="token function-variable function">paint</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            cxt<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cWidth<span class="token punctuation">,</span> cHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> endRadian <span class="token operator">=</span> sR <span class="token operator">+</span> text <span class="token operator">*</span> step<span class="token punctuation">;</span>
            <span class="token comment">// 画灰色圆弧</span>
            <span class="token function">drawCanvas</span><span class="token punctuation">(</span>cWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> cHeight <span class="token operator">-</span> bottom<span class="token punctuation">,</span> radiux<span class="token punctuation">,</span> sR<span class="token punctuation">,</span> sR <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token constant">PI</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token constant">PI</span> <span class="token operator">-</span> sR<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> baseColor<span class="token punctuation">,</span> insideBodrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 画蓝色圆弧</span>
            <span class="token function">drawCanvas</span><span class="token punctuation">(</span>cWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> cHeight <span class="token operator">-</span> bottom<span class="token punctuation">,</span> radiux<span class="token punctuation">,</span> sR<span class="token punctuation">,</span> endRadian<span class="token punctuation">,</span> coverColor<span class="token punctuation">,</span> outBorder<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 画红色圆头</span>
            <span class="token comment">// 红色圆头其实就是一个圆，关键的是找到其圆心，涉及到三角函数知识，自己画个图一看就明了</span>
            <span class="token keyword">const</span> angle <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token constant">PI</span> <span class="token operator">-</span> endRadian<span class="token punctuation">;</span> <span class="token comment">// 转换成逆时针方向的弧度（三角函数中的）</span>
            <span class="token keyword">const</span> xPos <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radiux <span class="token operator">+</span> cWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 灰色圆 圆心的x坐标</span>
            <span class="token keyword">const</span> yPos <span class="token operator">=</span> <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radiux <span class="token operator">+</span> cHeight <span class="token operator">-</span> bottom<span class="token punctuation">;</span> <span class="token comment">// 灰色圆 圆心的y坐标</span>

            <span class="token keyword">const</span> endRadians <span class="token operator">=</span> sR <span class="token operator">+</span> <span class="token punctuation">(</span>text <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">*</span> step<span class="token punctuation">;</span>
            <span class="token keyword">const</span> angles <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token constant">PI</span> <span class="token operator">-</span> endRadians<span class="token punctuation">;</span> <span class="token comment">// 转换成逆时针方向的弧度（三角函数中的）</span>
            <span class="token keyword">const</span> xsPos <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angles<span class="token punctuation">)</span> <span class="token operator">*</span> radiux <span class="token operator">+</span> cWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 蓝色圆 圆心的x坐标</span>
            <span class="token keyword">const</span> ysPos <span class="token operator">=</span> <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angles<span class="token punctuation">)</span> <span class="token operator">*</span> radiux <span class="token operator">+</span> cHeight <span class="token operator">-</span> bottom<span class="token punctuation">;</span> <span class="token comment">// 蓝色圆 圆心的y坐标</span>

            <span class="token comment">//跟着弧形动的白色⚪</span>
            <span class="token function">drawCanvas</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token constant">PI</span><span class="token punctuation">,</span> cileColor<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//弧形最开始的白色⚪</span>
            <span class="token function">drawCanvas</span><span class="token punctuation">(</span>cWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> radiux<span class="token punctuation">,</span> cHeight <span class="token operator">-</span> bottom <span class="token operator">+</span> <span class="token punctuation">(</span>outBorder <span class="token operator">-</span> insideBodrder<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token constant">PI</span><span class="token punctuation">,</span> cileColor<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//滚动金钱</span>
            <span class="token keyword">const</span> textMoney <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">thousandBitSeparator</span><span class="token punctuation">(</span><span class="token function">keep2DecimalFull</span><span class="token punctuation">(</span>actualPayamt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> HKD</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> textWidth <span class="token operator">=</span> cxt<span class="token punctuation">.</span><span class="token function">measureText</span><span class="token punctuation">(</span>textMoney<span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token punctuation">;</span>
            <span class="token comment">//画底层胶囊 为了实现边框效果 灰底</span>
            cxt<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>text <span class="token operator">&lt;=</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cxt<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>xsPos <span class="token operator">-</span> textWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> ysPos <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cxt<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>xsPos <span class="token operator">+</span> textWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> ysPos <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                cxt<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">255.43739679191134</span> <span class="token operator">-</span> textWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">158.38274739076002</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cxt<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">255.43739679191134</span> <span class="token operator">+</span> textWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">158.38274739076002</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            cxt<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">&quot;#f3f3f4&quot;</span><span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span>lineJoin <span class="token operator">=</span> <span class="token string">&quot;round&quot;</span><span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//画上层胶囊 为了实现内容区域 白底</span>
            cxt<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>text <span class="token operator">&lt;=</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cxt<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>xsPos <span class="token operator">-</span> textWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> ysPos <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cxt<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>xsPos <span class="token operator">+</span> textWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> ysPos <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                cxt<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">255.43739679191134</span> <span class="token operator">-</span> textWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">158.38274739076002</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cxt<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">255.43739679191134</span> <span class="token operator">+</span> textWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">158.38274739076002</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            cxt<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">&quot;#ffffff&quot;</span><span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span>lineJoin <span class="token operator">=</span> <span class="token string">&quot;round&quot;</span><span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//画字体</span>
            cxt<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;#484848&quot;</span><span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">&quot;48px&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>text <span class="token operator">&lt;=</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cxt<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>textMoney<span class="token punctuation">,</span> xsPos <span class="token operator">-</span> textWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> ysPos <span class="token operator">+</span> <span class="token number">14</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                cxt<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>textMoney<span class="token punctuation">,</span> <span class="token number">255.43739679191134</span> <span class="token operator">-</span> textWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">162.38274739076002</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            text<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>endRadian<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> finalRadian<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>paint<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
        window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>paint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token function-variable function">drawCanvas</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token operator">:</span> number<span class="token punctuation">,</span> y<span class="token operator">:</span> number<span class="token punctuation">,</span> r<span class="token operator">:</span> number<span class="token punctuation">,</span> sRadian<span class="token operator">:</span> number<span class="token punctuation">,</span> eRadian<span class="token operator">:</span> number<span class="token punctuation">,</span> color<span class="token operator">:</span> string<span class="token punctuation">,</span> lineWidth<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            cxt<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span>lineCap <span class="token operator">=</span> <span class="token string">&quot;round&quot;</span><span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> color<span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> lineWidth<span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> r<span class="token punctuation">,</span> sRadian<span class="token punctuation">,</span> eRadian<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cxt<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;#FFFFFF&quot;</span>
            cxt<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span>actualPayamt<span class="token punctuation">]</span><span class="token punctuation">)</span>


    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            min<span class="token operator">:</span> actualPayamt<span class="token punctuation">,</span>
            max<span class="token operator">:</span> totalPayment<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>actualPayamt<span class="token punctuation">,</span> totalPayment<span class="token punctuation">,</span>draw<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token function-variable function">getPixelRatio</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> backingStore <span class="token operator">=</span> context<span class="token punctuation">.</span>backingStorePixelRatio <span class="token operator">||</span>
            context<span class="token punctuation">.</span>webkitBackingStorePixelRatio <span class="token operator">||</span>
            context<span class="token punctuation">.</span>mozBackingStorePixelRatio <span class="token operator">||</span>
            context<span class="token punctuation">.</span>msBackingStorePixelRatio <span class="token operator">||</span>
            context<span class="token punctuation">.</span>oBackingStorePixelRatio <span class="token operator">||</span>
            context<span class="token punctuation">.</span>backingStorePixelRatio <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>devicePixelRatio <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> backingStore<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;_content&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>canvas id<span class="token operator">=</span><span class="token string">&quot;canvas&quot;</span> width<span class="token operator">=</span><span class="token string">&quot;300&quot;</span> height<span class="token operator">=</span><span class="token string">&quot;200&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>canvas<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Progress<span class="token punctuation">;</span>

<span class="token comment">// 圆形</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> <span class="token constant">FC</span><span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> thousandBitSeparator<span class="token punctuation">,</span> keep2DecimalFull <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'src/utils/NumUtils'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.scss'</span><span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">DashBoardProps</span> <span class="token punctuation">{</span>
    actualMonth<span class="token operator">:</span> any<span class="token punctuation">,</span>
    totalMonth<span class="token operator">:</span> any
<span class="token punctuation">}</span>

<span class="token keyword">const</span> DashBoard<span class="token operator">:</span> <span class="token constant">FC</span><span class="token operator">&lt;</span>DashBoardProps<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> actualMonth<span class="token punctuation">,</span> totalMonth <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
    <span class="token comment">// const [process,setProcess] = useState(0);</span>
    <span class="token keyword">const</span> circleLoading<span class="token operator">:</span>any <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">interface</span> <span class="token class-name">Draw</span> <span class="token punctuation">{</span>
        min<span class="token operator">:</span> number
        max<span class="token operator">:</span> number
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> draw <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> min<span class="token punctuation">,</span> max <span class="token punctuation">}</span><span class="token operator">:</span> Draw<span class="token punctuation">,</span> start<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>min <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> min <span class="token operator">&gt;</span> max<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> canvas<span class="token operator">:</span> any <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#dashCanvas'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            percent <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span>min <span class="token operator">/</span> max<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//最终百分比</span>
            circleX <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//中心x坐标</span>
            circleY <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//中心y坐标</span>
            radius <span class="token operator">=</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token comment">//圆环半径</span>
            cradius <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token comment">// canvas半径</span>
            lineWidth <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token comment">//圆形线条的宽度</span>
            fontSize <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token comment">//字体大小</span>


        <span class="token comment">//画圆</span>
        <span class="token keyword">const</span> <span class="token function-variable function">circle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">cx<span class="token operator">:</span> number<span class="token punctuation">,</span> cy<span class="token operator">:</span> number<span class="token punctuation">,</span> r<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//ctx.moveTo(cx + r, cy);</span>
            ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> lineWidth<span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">'#F3F3F4'</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">,</span> r<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cx:x坐标，cy:y坐标，r:半径 ，起始，结束 </span>
            ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//画弧线 startAngle:起点，endAngle：终点</span>
        <span class="token keyword">function</span> <span class="token function">sector</span><span class="token punctuation">(</span><span class="token parameter">cx<span class="token operator">:</span> number<span class="token punctuation">,</span> cy<span class="token operator">:</span> number<span class="token punctuation">,</span> r<span class="token operator">:</span> number<span class="token punctuation">,</span> startAngle<span class="token operator">:</span> number<span class="token punctuation">,</span> endAngle<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> lineWidth<span class="token punctuation">;</span>
            <span class="token comment">// 渐变色 </span>
            <span class="token keyword">var</span> linGrad <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createLinearGradient</span><span class="token punctuation">(</span>
                circleX <span class="token operator">-</span> radius <span class="token operator">-</span> lineWidth<span class="token punctuation">,</span> circleY<span class="token punctuation">,</span> circleX <span class="token operator">+</span> radius <span class="token operator">+</span> lineWidth<span class="token punctuation">,</span> circleY
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            linGrad<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token string">'#6DBDED'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            linGrad<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token string">'#67F5E0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> linGrad<span class="token punctuation">;</span>

            <span class="token comment">//圆弧两端的样式</span>
            ctx<span class="token punctuation">.</span>lineCap <span class="token operator">=</span> <span class="token string">'round'</span><span class="token punctuation">;</span>

            <span class="token comment">//圆弧</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>endAngle<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>
                    cx<span class="token punctuation">,</span> cy<span class="token punctuation">,</span> r<span class="token punctuation">,</span>
                    <span class="token punctuation">(</span> startAngle<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span> startAngle<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token punctuation">(</span>endAngle <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token boolean">false</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>
                    cx<span class="token punctuation">,</span> cy<span class="token punctuation">,</span> r<span class="token punctuation">,</span>
                    <span class="token punctuation">(</span> startAngle<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span> startAngle<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token punctuation">(</span>endAngle<span class="token operator">+</span><span class="token number">2</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token boolean">false</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
      
            ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">//刷新</span>
        <span class="token keyword">const</span> <span class="token function-variable function">loadingCircle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">process<span class="token operator">:</span>any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

            <span class="token comment">//清除canvas内容</span>
            ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> circleX <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> circleY <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token comment">//中间的字</span>
           ctx<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">'center'</span><span class="token punctuation">;</span>
           ctx<span class="token punctuation">.</span>textBaseline <span class="token operator">=</span> <span class="token string">'middle'</span><span class="token punctuation">;</span>
           ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'black'</span><span class="token punctuation">;</span>
           ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">' normal  bold 28px SF UI Display'</span><span class="token punctuation">;</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>min <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>min <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">,</span> circleX <span class="token operator">-</span> <span class="token number">14</span><span class="token punctuation">,</span> circleY <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>min <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">,</span> circleX <span class="token operator">-</span> <span class="token number">16</span><span class="token punctuation">,</span> circleY <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>


           ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#999'</span><span class="token punctuation">;</span>
           ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> fontSize <span class="token operator">+</span> <span class="token string">'px SF UI Display'</span><span class="token punctuation">;</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>min <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> circleX<span class="token punctuation">,</span> circleY <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>totalMonth <span class="token operator">+</span><span class="token string">''</span><span class="token punctuation">,</span> circleX <span class="token operator">+</span> <span class="token number">14</span><span class="token punctuation">,</span> circleY <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> circleX<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span> circleY <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>totalMonth <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">,</span> circleX <span class="token operator">+</span> <span class="token number">18</span><span class="token punctuation">,</span> circleY <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>

           ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'个月'</span><span class="token punctuation">,</span> circleX<span class="token punctuation">,</span> circleY <span class="token operator">+</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//圆形</span>
            <span class="token function">circle</span><span class="token punctuation">(</span>circleX<span class="token punctuation">,</span> circleY<span class="token punctuation">,</span> radius<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//圆弧</span>
            <span class="token function">sector</span><span class="token punctuation">(</span>circleX<span class="token punctuation">,</span> circleY<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> start<span class="token punctuation">,</span> process<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            process<span class="token operator">+=</span><span class="token number">2</span>

            circleLoading<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>process <span class="token operator">&gt;=</span> percent<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>circleLoading<span class="token punctuation">.</span>current <span class="token punctuation">)</span>
                    <span class="token keyword">return</span> 
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token function">loadingCircle</span><span class="token punctuation">(</span>process<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">loadingCircle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>actualMonth<span class="token punctuation">]</span><span class="token punctuation">)</span>


    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            min<span class="token operator">:</span> actualMonth<span class="token punctuation">,</span>
            max<span class="token operator">:</span> totalMonth<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>actualMonth<span class="token punctuation">,</span> totalMonth<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;_dashContent&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>canvas id<span class="token operator">=</span><span class="token string">&quot;dashCanvas&quot;</span> width<span class="token operator">=</span><span class="token string">&quot;130px&quot;</span> height<span class="token operator">=</span><span class="token string">&quot;130px&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>canvas<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> DashBoard<span class="token punctuation">;</span>

</code></pre></div><h3 id="上传文件"><a href="#上传文件" class="header-anchor">#</a> 上传文件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> throws <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;assert&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> info <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;console&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> nextTick <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;process&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> forwardRef<span class="token punctuation">,</span> useImperativeHandle<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">'../Button'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Toast <span class="token keyword">from</span> <span class="token string">&quot;../toast&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// import SparkMD5 from 'spark-md5';</span>
<span class="token keyword">import</span> <span class="token string">'./inputFile.scss'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">InputFileProps</span> <span class="token punctuation">{</span>
    onChange<span class="token operator">?</span><span class="token operator">:</span> any<span class="token punctuation">;</span>
    btnText<span class="token operator">:</span> string<span class="token punctuation">;</span>
    accept<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
    disabled<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span>
    multiple<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
    style<span class="token operator">?</span><span class="token operator">:</span> object<span class="token punctuation">;</span>
    isNeedProgress<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span> <span class="token comment">//是否需要进度条</span>
    onUploadSuccess<span class="token operator">?</span><span class="token operator">:</span> Function
    onUploadBefore<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> <span class="token comment">// 开始上传文件</span>
    onUploadProgress<span class="token operator">?</span><span class="token operator">:</span> Function  <span class="token comment">// 上传文件中</span>

<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> InputFile <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    onChange<span class="token punctuation">,</span>
    btnText<span class="token punctuation">,</span>
    accept <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
    disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    multiple <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 多个上传</span>
    style <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    onUploadSuccess<span class="token punctuation">,</span>
    onUploadBefore<span class="token punctuation">,</span>
    onUploadProgress<span class="token punctuation">,</span>
    isNeedProgress<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> InputFileProps<span class="token punctuation">,</span> ref<span class="token operator">:</span> any<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> <span class="token punctuation">[</span>inputType<span class="token punctuation">,</span> setInputType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">fileChange</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> fileInfo <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>files<span class="token punctuation">;</span>
        <span class="token keyword">let</span> fileList <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fileList<span class="token punctuation">,</span> <span class="token string">'fileList'</span><span class="token punctuation">)</span>

        <span class="token keyword">let</span> readBeforeList <span class="token operator">=</span> fileList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                isok<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
                info<span class="token operator">:</span><span class="token punctuation">{</span>
                    fileName<span class="token operator">:</span> item<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                    fileSize<span class="token operator">:</span> item<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
                    uploadStatus<span class="token operator">:</span> <span class="token string">'success'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        onUploadSuccess <span class="token operator">&amp;&amp;</span> <span class="token function">onUploadSuccess</span><span class="token punctuation">(</span>readBeforeList<span class="token punctuation">)</span>

        <span class="token comment">// 保存文件上传进度</span>
        <span class="token keyword">let</span> fileProgressObj<span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">await</span> fileList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            fileProgressObj<span class="token punctuation">[</span>item<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">setInputType</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">setInputType</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getFileInfo</span><span class="token punctuation">(</span>fileList<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> any<span class="token punctuation">,</span> cb<span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            onUploadBefore <span class="token operator">?</span> <span class="token function">onUploadBefore</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> any<span class="token punctuation">,</span> resolve<span class="token operator">:</span> any<span class="token punctuation">,</span> reject<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">.</span>fileName <span class="token operator">===</span> <span class="token string">'download.zip'</span> <span class="token operator">||</span> val<span class="token punctuation">.</span>fileName <span class="token operator">===</span> <span class="token string">'information (1).png'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    error<span class="token operator">:</span> <span class="token string">'上传失败'</span><span class="token punctuation">,</span>
                    fileName<span class="token operator">:</span> val<span class="token punctuation">.</span>fileName<span class="token punctuation">,</span>
                    fileSize<span class="token operator">:</span>val<span class="token punctuation">.</span>fileSize<span class="token punctuation">,</span>
                    uploadStatus<span class="token operator">:</span> <span class="token string">'fail'</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> 
            <span class="token punctuation">}</span>
            <span class="token comment">// 将本地文件上传至浏览器时读取进度条</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isNeedProgress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                fileProgressObj<span class="token punctuation">[</span>val<span class="token operator">?.</span>fileName<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token operator">?.</span>uploadProgress
                <span class="token keyword">let</span> currentObj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>fileProgressObj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token punctuation">{</span>
                        fileName<span class="token operator">:</span> item<span class="token punctuation">,</span>
                        progress<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fileProgressObj<span class="token punctuation">[</span>val<span class="token operator">?.</span>fileName<span class="token punctuation">]</span> <span class="token operator">/</span> val<span class="token operator">?.</span>fileSize<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token operator">?.</span>fileName<span class="token punctuation">,</span> fileProgressObj<span class="token punctuation">[</span>val<span class="token operator">?.</span>fileName<span class="token punctuation">]</span><span class="token punctuation">,</span> val<span class="token operator">?.</span>fileSize<span class="token punctuation">,</span> <span class="token string">'uploadProgress'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                onUploadProgress <span class="token operator">&amp;&amp;</span> <span class="token function">onUploadProgress</span><span class="token punctuation">(</span>currentObj<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">'result'</span><span class="token punctuation">)</span>
        <span class="token operator">!</span><span class="token operator">!</span>result<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> onUploadSuccess <span class="token operator">&amp;&amp;</span> <span class="token function">onUploadSuccess</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>

        onChange <span class="token operator">&amp;&amp;</span> <span class="token function">onChange</span><span class="token punctuation">(</span>fileList<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> position<span class="token operator">:</span> <span class="token string">'relative'</span><span class="token punctuation">,</span> <span class="token operator">...</span>style <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;btnWrap&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;addIcon&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>div
                    key<span class="token operator">=</span><span class="token string">'name'</span>
                    className<span class="token operator">=</span><span class="token string">&quot;addText&quot;</span>
                <span class="token operator">&gt;</span>
                    <span class="token punctuation">{</span>btnText<span class="token punctuation">}</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>input
                ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span>
                type<span class="token operator">=</span><span class="token punctuation">{</span>inputType<span class="token punctuation">}</span>
                onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">fileChange</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">}</span>
                disabled<span class="token operator">=</span><span class="token punctuation">{</span>disabled<span class="token punctuation">}</span>
                multiple<span class="token operator">=</span><span class="token punctuation">{</span>multiple<span class="token punctuation">}</span>
                style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                    opacity<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    width<span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span>
                    height<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                    position<span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
                    left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    zIndex<span class="token operator">:</span> <span class="token number">1000</span>
                <span class="token punctuation">}</span><span class="token punctuation">}</span>
                accept<span class="token operator">=</span><span class="token punctuation">{</span>accept<span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>



<span class="token comment">// 读取文件</span>
<span class="token keyword">const</span> <span class="token function-variable function">getFileInfo</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">fileList<span class="token operator">:</span> Array<span class="token operator">&lt;</span>File<span class="token operator">&gt;</span><span class="token punctuation">,</span> LoadStartCallBack<span class="token operator">:</span> Function<span class="token punctuation">,</span> onProgressCallBck<span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> readList<span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    fileList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        readList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">wrapPromise</span><span class="token punctuation">(</span><span class="token function">readFileInfo</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> LoadStartCallBack<span class="token punctuation">,</span> onProgressCallBck<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>readList<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment">// 文件是否上传成功</span>
    <span class="token comment">// let isAllupLoadSucess = result.every((val) =&gt; {</span>
    <span class="token comment">//     console.log(val, 'val')</span>
    <span class="token comment">//     if (!val?.isok) {</span>
    <span class="token comment">//         const { error } = val</span>
    <span class="token comment">//         Toast.info(error.fileName ? `${error.fileName} 上传失败` : error.error, { duration: 1000 })</span>
    <span class="token comment">//     }</span>
    <span class="token comment">//     return val?.isok</span>
    <span class="token comment">// })</span>

    <span class="token keyword">let</span> uploadFailFile <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">!</span>item<span class="token punctuation">.</span>isok
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">文件</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token operator">?.</span>info<span class="token operator">?.</span>fileName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 上传失败</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    Toast<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>uploadFailFile<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span> duration<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uploadFailFile<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'uploadFailFile'</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> result
<span class="token punctuation">}</span>


<span class="token keyword">const</span> <span class="token function-variable function">wrapPromise</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">promise<span class="token operator">:</span> Promise<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reslove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        promise
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reslove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isok<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> info <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 文件读取成功</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reslove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isok<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> info <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 文件读取失败</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">FileInfo</span> <span class="token punctuation">{</span>
    fileName<span class="token operator">:</span> string<span class="token punctuation">;</span>
    fileSize<span class="token operator">:</span> number<span class="token punctuation">;</span>
    uploadStatus<span class="token operator">:</span> string<span class="token punctuation">;</span>
    fileMD5<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
    chunk_file<span class="token operator">?</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>Blob<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> chunkSize <span class="token operator">=</span> <span class="token number">10485760</span><span class="token punctuation">;</span> <span class="token comment">// read in chunks of 10MB  每次读取文件大小</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">readFileInfo</span><span class="token punctuation">(</span>
    file<span class="token operator">:</span> File<span class="token punctuation">,</span>
    LoadStartCallBack<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span>  <span class="token comment">// 文件上传前</span>
    onProgressCallBck<span class="token operator">?</span><span class="token operator">:</span> Function   <span class="token comment">// 文件上传中</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>FileInfo<span class="token operator">&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> currentChunk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> chunks <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>size <span class="token operator">/</span> chunkSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> FileFragment<span class="token operator">:</span> Blob<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment">// const spark = new SparkMD5.ArrayBuffer();</span>

        <span class="token keyword">const</span> <span class="token function-variable function">fileOnLoad</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">)</span>
                currentChunk<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>currentChunk <span class="token operator">&lt;</span> chunks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">loadNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        fileName<span class="token operator">:</span> file<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                        fileSize<span class="token operator">:</span> file<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
                        uploadStatus<span class="token operator">:</span> <span class="token string">'success'</span>
                        <span class="token comment">// fileMD5: spark.end(),  //</span>
                        <span class="token comment">// chunk_file:FileFragment  //</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> <span class="token function-variable function">fileOnError</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                error<span class="token operator">:</span> <span class="token string">'上传失败'</span><span class="token punctuation">,</span>
                fileName<span class="token operator">:</span> file<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                fileSize<span class="token operator">:</span>file<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
                uploadStatus<span class="token operator">:</span> <span class="token string">'fail'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> <span class="token function-variable function">fileOnLoadStart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">cb<span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            LoadStartCallBack <span class="token operator">?</span> <span class="token function">LoadStartCallBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                file<span class="token operator">:</span> file<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">isUnNext<span class="token operator">?</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// isNext 返回false 继续上传 true 停止上传</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>isUnNext<span class="token punctuation">,</span> <span class="token string">'isUnNext'</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isUnNext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> <span class="token function-variable function">fileOnProgress</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> any<span class="token punctuation">,</span> size<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// console.log(val, 'progress')</span>
            onProgressCallBck <span class="token operator">&amp;&amp;</span> <span class="token function">onProgressCallBck</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                fileName<span class="token operator">:</span> file<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                fileSize<span class="token operator">:</span> file<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
                uploadProgress<span class="token operator">:</span> size
            <span class="token punctuation">}</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileReader<span class="token punctuation">.</span>onload <span class="token operator">=</span> fileOnLoad<span class="token punctuation">;</span>
            fileReader<span class="token punctuation">.</span>onerror <span class="token operator">=</span> fileOnError<span class="token punctuation">;</span>
            fileReader<span class="token punctuation">.</span><span class="token function-variable function">onloadstart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// fileReader.abort()</span>
            <span class="token keyword">const</span> start <span class="token operator">=</span> currentChunk <span class="token operator">*</span> chunkSize<span class="token punctuation">;</span>
            <span class="token keyword">const</span> end <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>start <span class="token operator">+</span> chunkSize<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> file<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token operator">?</span> file<span class="token punctuation">.</span>size <span class="token operator">:</span> start <span class="token operator">+</span> chunkSize<span class="token punctuation">;</span>
            fileReader<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fileOnProgress</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 将文件分片</span>
            <span class="token keyword">let</span> fragment <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span>
            <span class="token comment">// 将文件切片存储</span>
            FileFragment<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span>
            <span class="token comment">// 分片读取 防止读取失败</span>
            fileReader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">fileOnLoadStart</span><span class="token punctuation">(</span>loadNext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">5/13/2022, 2:55:54 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/WeiBo/react/hook.html" class="prev">
        自定义HOOK
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/WeiBo/assets/js/app.de0b0b11.js" defer></script><script src="/WeiBo/assets/js/2.36bf89d1.js" defer></script><script src="/WeiBo/assets/js/25.72d6a3ee.js" defer></script>
  </body>
</html>
